<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>李克兢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="李克兢">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="李克兢">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="李克兢">
  
    <link rel="alternate" href="/atom.xml" title="李克兢" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">李克兢</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-动画" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/动画/" class="article-date">
  <time datetime="2018-08-07T06:13:39.000Z" itemprop="datePublished">2018-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/动画/">动画</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="预备工作：将gif转换成一个个帧的图片"><a href="#预备工作：将gif转换成一个个帧的图片" class="headerlink" title="预备工作：将gif转换成一个个帧的图片"></a>预备工作：将gif转换成一个个帧的图片</h2><p>使用在线工具Piskel将gif导出为png的zip包</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>对象类在draw的时候，每隔几帧换一个图片</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuaAnimation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(game) &#123;</span><br><span class="line">        <span class="keyword">this</span>.game = game</span><br><span class="line">        <span class="keyword">this</span>.frames = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// let name = 'player'+i</span></span><br><span class="line">            <span class="keyword">let</span> name = <span class="string">`player<span class="subst">$&#123;i&#125;</span>`</span></span><br><span class="line">            <span class="keyword">let</span> t = <span class="keyword">this</span>.game.getImgFromName(name)</span><br><span class="line">            <span class="comment">//当一个变量用一会儿就不用的时候,就用一个字母代替</span></span><br><span class="line">            <span class="keyword">this</span>.frames.push(t)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.texture = <span class="keyword">this</span>.frames[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">this</span>.frameIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.frameCount = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">this</span>.x = <span class="number">50</span></span><br><span class="line">        <span class="keyword">this</span>.y = <span class="number">50</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">new</span>(game) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">this</span>(game)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    update() &#123;</span><br><span class="line">        <span class="keyword">this</span>.frameCount--</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.frameCount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.frameCount = <span class="number">3</span></span><br><span class="line">            <span class="keyword">this</span>.frameIndex = (<span class="keyword">this</span>.frameIndex + <span class="number">1</span>) % <span class="keyword">this</span>.frames.length</span><br><span class="line">            <span class="keyword">this</span>.texture = <span class="keyword">this</span>.frames[<span class="keyword">this</span>.frameIndex]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这样使得每三帧切换一次图片</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    draw() &#123;</span><br><span class="line">        log(<span class="keyword">this</span>.frameIndex)</span><br><span class="line">        <span class="keyword">this</span>.game.drawImage(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="如果有多种状态"><a href="#如果有多种状态" class="headerlink" title="如果有多种状态"></a>如果有多种状态</h2><p>frames数组需要改为animations对象，animations对象中存着不同状态下图片的数组</p>
<p><code>this.texture = this.animations[this.animationName][0]</code></p>
<p>或者采用一个函数（会重复使用的地方都可以用函数替换）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frames()&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.animations[<span class="keyword">this</span>.animationName]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现翻转图片操作"><a href="#实现翻转图片操作" class="headerlink" title="实现翻转图片操作"></a>实现翻转图片操作</h2><h2 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h2><ol>
<li><p>当一个变量生命周期很短的情况下，就用一个字母来做变量名</p>
</li>
<li><p>每三帧换一次图片，使用这种写法。注意触类旁通</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.frameIndex = <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.frameCount = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">update() &#123;</span><br><span class="line">        <span class="keyword">this</span>.frameCount--</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.frameCount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.frameCount = <span class="number">3</span></span><br><span class="line">            <span class="keyword">this</span>.frameIndex = (<span class="keyword">this</span>.frameIndex + <span class="number">1</span>) % <span class="keyword">this</span>.frames.length</span><br><span class="line">            <span class="keyword">this</span>.texture = <span class="keyword">this</span>.frames[<span class="keyword">this</span>.frameIndex]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="拓展知识"><a href="#拓展知识" class="headerlink" title="拓展知识"></a>拓展知识</h1><p>在Javascript中使用模板字符串</p>
<p>简单版本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用反引号 (``) 来代替普通字符串中的用双引号和单引号。模板字符串可以包含特定语法（$&#123;expression&#125;）的占位符</span></span><br></pre></td></tr></table></figure>
<p>复杂版本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createStrWithFormat = <span class="function"><span class="keyword">function</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">var</span> pattern = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"%([0-9]+)"</span>, <span class="string">"g"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(string).replace(pattern</span><br><span class="line">            , <span class="function"><span class="keyword">function</span> (<span class="params">match, index</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (index == <span class="number">0</span> || index &gt;= args.length) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="string">"Invalid index in format string"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> args[index];</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        log(<span class="string">"createWithFormat error : "</span> + e);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">createStrWithFormat(<span class="string">"this is a %1 speaking"</span>, <span class="string">"male"</span>)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/07/动画/" data-id="cjkjffpv0000qhov0fwt4ou60" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript-萧井陌/">Javascript 萧井陌</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-马里奥01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/马里奥01/" class="article-date">
  <time datetime="2018-08-07T01:46:10.000Z" itemprop="datePublished">2018-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/马里奥01/">马里奥01</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>实现对Nes文件中图像的提取（上）</p>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>调试所需的浏览器使用FirefoxDeveloperEdition，因为有跨域问题，只有火狐开发者版本可以。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><blockquote>
<p>红白机的图像技术的核心是所谓的 tile 和 block。所谓 tile 就是一块 8x8 像素大小的区域，一个 block 就是 16x16 大小的区域。多个以上的结构对齐，就产生了我们看到的图像。</p>
</blockquote>
<p>详见<a href="https://zhuanlan.zhihu.com/p/34144965" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34144965</a></p>
<p>一个Tile 8x8 像素</p>
<p>每个像素2 bits</p>
<p>所以一个Tile 16 bytes</p>
<p>将所有资源以这种形式提取出来显示，即可以找到需要的图像</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>每页显示8X8个Tiles，将每个像素都扩大十倍。设置画布设置为640X640</p>
<p>通过ajax拿到数据，实现drawNes方法</p>
<h2 id="drawNes"><a href="#drawNes" class="headerlink" title="drawNes"></a>drawNes</h2><p>drawNes方法负责画满canvas</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> drawNes = <span class="function"><span class="params">bytes</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> canvas = e(<span class="string">"#id-canvas"</span>)</span><br><span class="line">        <span class="keyword">let</span> context = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line">        <span class="keyword">let</span> tileNum = <span class="number">8</span><span class="comment">//一页8x8个tiles</span></span><br><span class="line">        <span class="keyword">let</span> tileSize = <span class="number">8</span><span class="comment">//一个tile有8x8个像素</span></span><br><span class="line">        <span class="keyword">let</span> pixelwidth = <span class="number">10</span><span class="comment">//每个像素的宽度</span></span><br><span class="line">        <span class="keyword">let</span> numberOfBytesPerTile = <span class="number">16</span><span class="comment">//16个字节一个图块</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tileNum; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; tileNum; j++) &#123;</span><br><span class="line">                <span class="comment">//算出bytes</span></span><br><span class="line">                <span class="keyword">let</span> x = j * tileSize * pixelwidth</span><br><span class="line">                <span class="keyword">let</span> y = i * tileSize * pixelwidth</span><br><span class="line">                <span class="keyword">let</span> index = <span class="built_in">window</span>.offset + (i * tileNum + j) * numberOfBytesPerTile</span><br><span class="line">                <span class="comment">//其实应该drawTile更准确</span></span><br><span class="line">                drawTile(context, bytes.slice(index), x, y, pixelwidth)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="drawTile"><a href="#drawTile" class="headerlink" title="drawTile"></a>drawTile</h2><p>draw每个tile</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> drawTile = <span class="function">(<span class="params">context, data, x, y, pixelwidth</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> colors = [</span><br><span class="line">        <span class="string">'white'</span>,</span><br><span class="line">        <span class="string">'#fe1000'</span>,</span><br><span class="line">        <span class="string">'#ffb010'</span>,</span><br><span class="line">        <span class="string">'#aa3030'</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">let</span> w = pixelwidth</span><br><span class="line">    <span class="keyword">let</span> h = pixelwidth</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> p1 = data[i]</span><br><span class="line">        <span class="keyword">let</span> p2 = data[i + <span class="number">8</span>]</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="comment">//8 bit per line</span></span><br><span class="line">            <span class="comment">//在j循环中每一次画一个像素点</span></span><br><span class="line">            <span class="comment">//78 69</span></span><br><span class="line">            <span class="comment">//0100 1110   0100 0101</span></span><br><span class="line">            <span class="keyword">let</span> c1 = (p1 &gt;&gt; (<span class="number">7</span> - j)) &amp; <span class="number">0b00000001</span></span><br><span class="line">            <span class="keyword">let</span> c2 = (p2 &gt;&gt; (<span class="number">7</span> - j)) &amp; <span class="number">0b00000001</span></span><br><span class="line">            <span class="keyword">let</span> pixel = (c2 &lt;&lt; <span class="number">1</span>) + c1</span><br><span class="line">            <span class="comment">// if (pixel == 0)&#123;</span></span><br><span class="line">            <span class="comment">//     continue</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="keyword">let</span> color = colors[pixel]</span><br><span class="line">            context.fillStyle = color</span><br><span class="line">            <span class="keyword">let</span> px = x + j * w</span><br><span class="line">            <span class="keyword">let</span> py = y + i * h</span><br><span class="line">            context.fillRect(px, py, w, h)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="绑定点击事件"><a href="#绑定点击事件" class="headerlink" title="绑定点击事件"></a>绑定点击事件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"gua-controls"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"change_offset"</span> <span class="attr">data-offset</span>=<span class="string">"-1024"</span>&gt;</span>-1024<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"change_offset"</span> <span class="attr">data-offset</span>=<span class="string">"-16"</span>&gt;</span>-16<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"change_offset"</span> <span class="attr">data-offset</span>=<span class="string">"16"</span>&gt;</span>16<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"change_offset"</span> <span class="attr">data-offset</span>=<span class="string">"1024"</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    change_offset(offset) &#123;</span><br><span class="line">        <span class="built_in">window</span>.offset += offset</span><br><span class="line">        e(<span class="string">'h3'</span>).innerHTML = <span class="built_in">window</span>.offset</span><br><span class="line">        drawNes(<span class="built_in">window</span>.bytes)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> bindEvent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    e(<span class="string">'.gua-controls'</span>).addEventListener(<span class="string">'click'</span>, event =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> action = event.target.dataset.action</span><br><span class="line">        <span class="keyword">let</span> offset = <span class="built_in">Number</span>(event.target.dataset.offset)</span><br><span class="line">        actions[action] &amp;&amp; actions[action](offset)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过表的方式来替代if语句</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/07/马里奥01/" data-id="cjkjffpvb0016hov0bfswmml0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript-萧井陌/">Javascript 萧井陌</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ES-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/06/ES-1/" class="article-date">
  <time datetime="2018-08-06T07:32:12.000Z" itemprop="datePublished">2018-08-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/06/ES-1/">ES-1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>OpenGL ES的主要作用是将3D场景绘制到2D屏幕上，在图形学中，这一过程通过一系列的渲染管线完成。</p>
<p>API就是用来向各个阶段提供一些数据和状态指令，以使渲染管线能够按照要求正确地将物体绘制在屏幕上的。</p>
<p>左边的客户端程序通过调用OpenGL ES接口，将顶点、着色器程序，纹理，以及其他GL状态参数传入右边的GL服务端，然后在客户端调用绘制命令（如DrawArray），GL便会对输入的图元逐一执行渲染管线的每个阶段，然后将每个像素的颜色值写入帧缓冲中，最后，视窗系统就可以将帧缓冲中的颜色值显示在屏幕上了。</p>
<p>顶点着色器和片段着色器是可编程的过程</p>
<h2 id="顶点数组"><a href="#顶点数组" class="headerlink" title="顶点数组"></a>顶点数组</h2><p>在传入OpenGL ES之前，应用程序应该将3D模型转换成一组图元的集合。每个图元都是一个点、线段或者三角形。每个图元由一个或者多个顶点组成，每个顶点定义一个点，一条边的一端或者三角形的一个角。每个顶点关联一些数据，这些数据包括顶点坐标、颜色法线向量，纹理坐标</p>
<p>通过顶点缓冲对象(vbo)绑定顶点数组,</p>
<h2 id="顶点着色器"><a href="#顶点着色器" class="headerlink" title="顶点着色器"></a>顶点着色器</h2><p>顶点着色器可以使用顶点数据来计算该顶点的坐标、颜色、光照、纹理坐标等。顶点坐标最重要的任务是执行顶点坐标变换，将本地坐标转换为裁剪坐标系的坐标值。顶点着色器用于输出顶点在裁剪坐标系中的坐标的变量为gl_Position。</p>
<p>另一个功能是向后面的片段着色器提供一组Varing变量</p>
<h2 id="图元装配"><a href="#图元装配" class="headerlink" title="图元装配"></a>图元装配</h2><h2 id="光栅化"><a href="#光栅化" class="headerlink" title="光栅化"></a>光栅化</h2><p>对图元中的片段进行采样，以决定哪些片段位于图元之内。在计算出每个片段的坐标值之后，片段着色器就能使用这个坐标值对该片段进行着色了，这个片段为最终屏幕上的一个像素点</p>
<h2 id="片段着色器"><a href="#片段着色器" class="headerlink" title="片段着色器"></a>片段着色器</h2><p>主要作用是计算每一个片段的颜色值</p>
<h2 id="片段测试"><a href="#片段测试" class="headerlink" title="片段测试"></a>片段测试</h2><p>像素所有权测试，裁剪测试，模板测试，深度测试，混合，抖动</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/06/ES-1/" data-id="cjkjffpuf0004hov0mhjcrd56" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cocos2d-x精灵" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/31/Cocos2d-x精灵/" class="article-date">
  <time datetime="2018-07-31T09:22:39.000Z" itemprop="datePublished">2018-07-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/31/Cocos2d-x精灵/">Cocos2d-x精灵</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在Cocos2d-x中，精灵用Sprite类表示，它将一张纹理的一部分或者全部矩形区域绘制在屏幕上。我们可以使用精灵表来减少OpenGL ES绘制的次数</p>
<p>Sprite实现了TextureProtocol接口通过指定一张纹理及该纹理上的一个区域，就可以创建一个Sprite对象。</p>
<p>我们可以通过setTexture方法来动态修改Sprite关联的纹理，从而实现精灵动画。也可以使用SpriteFrame来高效地播放精灵动画。setTexture方法对新的texture执行retain操作，增加其引用计数</p>
<p>所有对Sprite绘制属性的修改（混合模式除外）最终都表现为对一个结构体类型变量quad的修改。</p>
<p>它用来记录一个矩形图元的4个顶点的顶点属性。由于OpenGL ES不支持多边形图元，实际是两个三角形</p>
<p>可以通过颜色混合和颜色叠加来影响OpenGL ES的绘制结果</p>
<p>颜色混合用来指定当前Sprite与颜色缓冲区中相同位置颜色值的混合方式。</p>
<h1 id="精灵表"><a href="#精灵表" class="headerlink" title="精灵表"></a>精灵表</h1><p>利用精灵表，我们可以对同一次绘制指定更多的顶点来减少绘制次数</p>
<p>SpriteFrameCache加载精灵表，缓存每一个精灵的信息。SpriteFrameCache通过解析配置文件将精灵表中的每个精灵存储为一个SpriteFrame对象，可以通过SpriteFrame创建一个Sprite</p>
<p>并不提供移除对应于Texture2D对象的功能。因为一个Texture2D对象可能被其他非SpriteFrame对象引用，所以，如果我们确定一个精灵表不再被使用，还应该移除对应的Texture2D对象</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/31/Cocos2d-x精灵/" data-id="cjkjffpu50000hov0udo8te7o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocos2d-x-OpenGL/">Cocos2d-x OpenGL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Cocos2d-x纹理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/30/Cocos2d-x纹理/" class="article-date">
  <time datetime="2018-07-30T01:32:01.000Z" itemprop="datePublished">2018-07-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/30/Cocos2d-x纹理/">Cocos2d-x纹理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>3D图形渲染最重要的工作之一是将纹理应用到物体表面，这个过程主要发生在片段着色器工作的阶段，使用光栅化阶段插值计算得出的纹理坐标从纹理中采样，然后对片段进行着色，可以处理丰富的特效，如光照、阴影等。</p>
<p>对纹理进行各个层面的优化是一项重要的工作，我们需要知道关于纹理的一切内容，才能知道应该从哪方面以及怎样对其进行优化。</p>
<p>在Cocos2d-x中主要通过Texture2D类来创造和管理OpenGL ES 纹理。</p>
<h1 id="光栅化"><a href="#光栅化" class="headerlink" title="光栅化"></a>光栅化</h1><p>光栅化阶段用于将投影到2D屏幕上的图元转换为帧缓冲中整数坐标位置上的片段，每个片段都会包含颜色、深度和模板值。每个片段的颜色值由片段着色器决定，片段着色器会使用光栅化生成的一些易变变量（Varying）</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>首先确定视窗上哪些整数的片段需要被图元覆盖</p>
<p>对图元进行插值运算，得出每个片段的颜色和深度，这些数据送入片段操作进行处理，最后的结果将用于更新帧缓冲上该位置的信息。</p>
<h1 id="多重采样"><a href="#多重采样" class="headerlink" title="多重采样"></a>多重采样</h1><h2 id="反锯齿"><a href="#反锯齿" class="headerlink" title="反锯齿"></a>反锯齿</h2><p>也称抗锯齿和边缘柔化，是一种用于消除显示器输出的画面中图像边缘出现锯齿的技术。锯齿通常是因为高分辨率信号以低分辨率显示或者无法准确计算出3D图形左边是导致的图形混叠而产生的。</p>
<p>使用多重采样技术解决这个问题，帧缓冲上的每个像素基于附近多个位置的采样共同决定的一个颜色值，使用而外的多重采样缓冲区来存储这些额外采样点的颜色、深度和模板值</p>
<p>默认cocos不开启，手动修改CCEAGLView初始化的multiSampling参数来开启</p>
<p>在开启多重采样之后，缓冲区的像素信息不再被存储到帧缓冲中，而是被存储到一个特殊的多重采样的缓冲区中,注意，多重采样只是针对多边形的边缘进行抗锯齿处理，对应用程序性能的影响相对较小，</p>
<h2 id="纹理坐标"><a href="#纹理坐标" class="headerlink" title="纹理坐标"></a>纹理坐标</h2><p>纹理坐标以纹理的左下角为左边原点，两种度量形式：一个顶点在纹理中的纹理坐标通常用(u,v)表示，u和v的最大值分别是纹理的宽度和高度，它的值通常由客户端应用程序提供，在片段着色器中使用的片段纹理坐标通常用(s,t)表示，其取值范围为(0.0,0.0)~(1.0,1.0)。这一规化过程是在光栅化阶段完成的</p>
<p>##像素矩形</p>
<p>它表示一个矩形区域的二维像素数组，它可以用来表示一个矩形区域的颜色、深度或者模板值</p>
<p>存储颜色值的像素矩形可以通过TexImage2D及其相关命令定义，并将数据由客户端内存中传输至GL服务端内存中，或者通过ReadPixels及相关命令将数据从帧缓冲区中读取到客户端内存中，其中将客户端的颜色数据传输到GL服务端的过程称为解包（Unpack）,而与之相反，将服务端像素矩形中的像素数据读取到客户端的过程称为打包（Pack）。</p>
<p>通过TexImage2D及相关命令定义的像素矩形称为纹理。纹理由纹理像素组成，简称纹素。一个2D纹理由一个二维的纹素数组组成，纹理的宽度表示列数，高度表示数组的行数，数组中的第一个元素表示纹理左下角的像素点</p>
<h3 id="纹理数据的传输"><a href="#纹理数据的传输" class="headerlink" title="纹理数据的传输"></a>纹理数据的传输</h3><p>##客户端图像格式</p>
<p>在将纹理传输到GL服务端以供片段着色器等使用时，我们必须指明纹理在服务端以怎样的方式存储，这需要通过TexImage2D等命令来设置。</p>
<h2 id="纹理对象和加载纹理"><a href="#纹理对象和加载纹理" class="headerlink" title="纹理对象和加载纹理"></a>纹理对象和加载纹理</h2><p>在绘图管线中，纹理主要在片段着色器中被使用。每一次绘制命令（glDrawArray或者glDrawElements）执行时，需要告诉OpenGL ES当前管线中使用的一个或者多个纹理，这涉及管理纹理对象，绑定当前纹理对象，将纹理数据加载到OpenGL ES内存中等命令操作。</p>
<p>一个纹理对象是一个容器，它持有该纹理被使用时需要用到的所有数据，包括图像像素数据、过滤模式、拓展模式等。在OpenGL ES中，用一个无符号整数表示该纹理对象的名称，纹理对象用glGenTextures命令创建</p>
<p>创建之后，必须绑定才能操作，在这里OpenGL ES通过设定当前纹理对象对其进行操作，设定当前纹理对象之后，后续（直到纹理对象被删除或者下一个纹理绑定命令被执行之前）的操作将作用在该纹理对象上。glBindTexture命令</p>
<p>glTexImage2D命令加载纹理。一旦该命令执行，会立即将图像像素数据从客户端传输到服务端内存中，后续对客户端数据的修改不会影响OpenGL ES中绑定的纹理数据。因此，客户端在将数据加载到OpenGL ES内存中之后，应该立即删除客户端中的缓存对象。</p>
<h1 id="纹理缓存管理"><a href="#纹理缓存管理" class="headerlink" title="纹理缓存管理"></a>纹理缓存管理</h1><p>我们可以通过选择适当的图片格式，或者使用压缩纹理来减少纹理对内存的占用。</p>
<p>纹理缓存系统的主要目标是使只有当前场景需要显示的纹理驻留在内存中，开发者的职责则是要定义哪些是当前场景需要使用的资源。另外，在纹理使用期间，它应该只被创建一次，并且避免动态加载纹理，我们始终应该在进入一个场景时预加载相关纹理，这是一个耗时的操作，而且是在主线程中完成的。</p>
<h3 id="纹理的生命周期"><a href="#纹理的生命周期" class="headerlink" title="纹理的生命周期"></a>纹理的生命周期</h3><p>在Cocos2d-x中，一个Texture2D实例对应OpenGL ES中的一张纹理，initWithMipmaps ()方法。</p>
<p>每个Texture2D实例在未被销毁之前，GPU会一直缓存该纹理对象。如果销毁Texture2D，则会删除对应的纹理对象。</p>
<p>TextureCache提供了对Texture2D对象的更好的管理方式</p>
<p>##TextureCache</p>
<p>TextureCache最终要的功能是为每个纹理的Texture2D对象创建一个索引键，索引键主要有两类：当使用文件名创建纹理的时候，文件所在全路径成为索引键。也可以手动给通过Image创建的纹理分配一个指定的索引键</p>
<p>使用addImageAsync()方法异步加载纹理，通常用在进入一个新场景里面，使用一个加载页面</p>
<p>TextureCache管理下的纹理的生命周期</p>
<p>没有TextureCache的情况下，直接通过string、image或者data创建一个Texture2D对象，这时该对象的引用计数为1.用该对象构建一个Sprite元素，Sprite元素首先对它进行retain以确保纹理对象不被删除，并在被移出场景的时候release，此时Texture2D的生命周期取决于我们是否还要继续使用它。但是无论如何，我们都需要记住每个Texture2D对象对应哪一张图片，而且要让这些独立的Texture2D对象在其他的类中被使用要费一般周折</p>
<p>TextureCache中的每个Texture2D对象的引用计数是1，如果有元素正在使用该纹理，则引用计数为正在使用的元素个数加1.1表示空闲状态，使用removeUnusedTextures()方法来移除空闲的纹理以释放资源。</p>
<p>如果确认某个纹理不再使用，removeTexture()，这时Texture2D对象将执行一次release</p>
<h2 id="场景过度中的资源管理"><a href="#场景过度中的资源管理" class="headerlink" title="场景过度中的资源管理"></a>场景过度中的资源管理</h2><h4 id="基于引用计数的资源管理"><a href="#基于引用计数的资源管理" class="headerlink" title="基于引用计数的资源管理"></a>基于引用计数的资源管理</h4><p>计数指的是应用程序在逻辑上使用哪些资源</p>
<h4 id="更好的场景过度资源管理"><a href="#更好的场景过度资源管理" class="headerlink" title="更好的场景过度资源管理"></a>更好的场景过度资源管理</h4><p>Cocos2d-x没有提供场景或者关卡层面上的资源管理方案。</p>
<p>ResourceManager负责逻辑上的资源引用计数管理。记录每个资源在场景中的引用情况。应用程序只需要和ResourceManager进行交互。</p>
<p>ResourceManager主要作用是解决场景之间的资源共享</p>
<h2 id="纹理所占内存的计算"><a href="#纹理所占内存的计算" class="headerlink" title="纹理所占内存的计算"></a>纹理所占内存的计算</h2><h2 id="使用纹理的最佳实践"><a href="#使用纹理的最佳实践" class="headerlink" title="使用纹理的最佳实践"></a>使用纹理的最佳实践</h2><h3 id="硬件层面"><a href="#硬件层面" class="headerlink" title="硬件层面"></a>硬件层面</h3><p>一般通过引擎完成</p>
<h3 id="程序层面"><a href="#程序层面" class="headerlink" title="程序层面"></a>程序层面</h3><p>首先，始终提前加载资源，避免在游戏运行中动态加载资源</p>
<p>其次，减少纹理的内存占用，实时释放那些不再被使用的纹理资源，这要求开发者必须清楚地定义每个资源的生命周期</p>
<p>再次，我们应该将一些小的碎片纹理合成一张大的纹理</p>
<p>第四，使用多级纹理减少内存的占用。对于一些低分辨率的设备，仅上传对应级别的多级纹理</p>
<p>第五，使员工多重纹理，对于一些复杂的UI元素，开发者通常会选择绘制多次，每次单独使用一个纹理，这使得绘制次数增加，占用更多的时间（多次绘制串行执行），以及重复的顶点数据的传输和读取。使用多级纹理一次性将所有问哦李传入进一个渲染管线</p>
<p>最后，使用Alpha预乘来减少透明纹理在场景混合时的计算量</p>
<h3 id="资源层面"><a href="#资源层面" class="headerlink" title="资源层面"></a>资源层面</h3><p>选择适当的资源格式</p>
<p>设置正确的defaultAlphaPixelFormat将不同格式的纹理上传GL内存</p>
<p>使用压缩纹理</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/30/Cocos2d-x纹理/" data-id="cjkjffpvu001bhov0qtbnevcu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocos2d-x-OpenGL/">Cocos2d-x OpenGL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Cocos2d-x的优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/28/Cocos2d-x的优化/" class="article-date">
  <time datetime="2018-07-28T02:16:15.000Z" itemprop="datePublished">2018-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/28/Cocos2d-x的优化/">Cocos2d-x的优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cocos2d-JS"><a href="#Cocos2d-JS" class="headerlink" title="Cocos2d-JS"></a>Cocos2d-JS</h1><h2 id="对象缓存池"><a href="#对象缓存池" class="headerlink" title="对象缓存池"></a>对象缓存池</h2><p>###简介</p>
<p>对于频繁创建和销毁的对象（如子弹、敌人）使用cc.pool对象。</p>
<p>注：使用cc.pool之前需要在project.json的modules数组中添加ccpool项</p>
<p>###使用</p>
<ol>
<li>让类支持cc.pool管理：类必须实现reuse和unuse方法。因为对象的缓存通过cc.pool.putInPool(object)函数实现，该函数会调用该对象的unuse方法。一般情况下，在unuse方法中完成对象被放入缓冲池前的操作。</li>
<li>预备工作：首次创建好一定量的对象，并把他们放入缓冲池。</li>
</ol>
<p>在游戏场景结束，切换场景的时候，调用cc.pool.drainAllPools()清空对象缓存池。</p>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SupportPoolHero = cc.Sprite.extend(&#123;</span><br><span class="line">    _hp : <span class="number">0</span>,    <span class="comment">// 血量</span></span><br><span class="line">    _sp : <span class="number">0</span>,    <span class="comment">// 愤怒</span></span><br><span class="line">    _mp : <span class="number">0</span>,    <span class="comment">// 魔法</span></span><br><span class="line">    ctor: <span class="function"><span class="keyword">function</span> (<span class="params">hp, mp, sp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._super(res.sh_node_64_png);</span><br><span class="line">        <span class="keyword">this</span>.initData(hp, mp, sp);</span><br><span class="line">    &#125;,</span><br><span class="line">    initData: <span class="function"><span class="keyword">function</span> (<span class="params">hp, mp, sp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._hp, <span class="keyword">this</span>._mp, <span class="keyword">this</span>._sp = hp, mp, sp;</span><br><span class="line">    &#125;,</span><br><span class="line">    unuse: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._hp = <span class="keyword">this</span>._mp = <span class="keyword">this</span>._sp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.retain(); <span class="comment">// 使其引用计数+1，防止被内存回收</span></span><br><span class="line">        <span class="keyword">this</span>.removeFromParent();</span><br><span class="line">    &#125;,</span><br><span class="line">    reuse: <span class="function"><span class="keyword">function</span> (<span class="params">hp, mp, sp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.initData(hp, mp, sp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">SupportPoolHero.create = <span class="function"><span class="keyword">function</span> (<span class="params">hp, mp, sp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SupportPoolHero(hp, mp, sp)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SupportPoolHero.reCreate = <span class="function"><span class="keyword">function</span> (<span class="params">hp, mp, sp</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 判断[对象缓冲池中是否有可用对象]</span></span><br><span class="line">    <span class="keyword">if</span> (cc.pool.hasObject(SupportPoolHero))&#123;</span><br><span class="line">        <span class="comment">// 从对象缓冲池中获取对象</span></span><br><span class="line">        <span class="keyword">return</span> cc.pool.getFromPool(SupportPoolHero, hp, mp, sp);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个新的对象</span></span><br><span class="line">        <span class="keyword">return</span>  SupportPoolHero.create(hp, mp, sp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> CCPoolLayer = cc.Layer.extend(&#123;</span><br><span class="line">    createCount         : <span class="number">3000</span>,</span><br><span class="line">    createHeroList      : [],</span><br><span class="line">    reCreateHeroList    : [],</span><br><span class="line">    timeList            : &#123;&#125;,</span><br><span class="line">    ctor : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._super();</span><br><span class="line">        <span class="comment">// 加载[菜单]_2种方式创建对象</span></span><br><span class="line">        <span class="keyword">this</span>.loadMenu();</span><br><span class="line">        <span class="comment">// 加载[标签]_加载时间反馈</span></span><br><span class="line">        <span class="keyword">this</span>.loadLabelInfo();</span><br><span class="line">        <span class="comment">// 为pool准备对象</span></span><br><span class="line">        <span class="keyword">this</span>.prepareHeroForPool();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载[菜单]_2种方式创建对象</span></span><br><span class="line">    loadMenu : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 创建[标签]_按钮文本说明</span></span><br><span class="line">        <span class="keyword">var</span> labCreate = <span class="keyword">new</span> cc.LabelTTF(<span class="string">"直接创建"</span> + <span class="keyword">this</span>.createCount + <span class="string">"个精灵！"</span>, <span class="string">"Arial"</span>, <span class="number">24</span>);</span><br><span class="line">        <span class="keyword">var</span> labReCreate = <span class="keyword">new</span> cc.LabelTTF(<span class="string">"使用pool创建"</span> + <span class="keyword">this</span>.createCount + <span class="string">"个精灵！"</span>, <span class="string">"Arial"</span>, <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建[菜单项]</span></span><br><span class="line">        <span class="keyword">var</span> itemCreate = <span class="keyword">new</span> cc.MenuItemLabel(labCreate, <span class="keyword">this</span>.addSpriteByCreate, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">var</span> itemReCreate = <span class="keyword">new</span> cc.MenuItemLabel(labReCreate, <span class="keyword">this</span>.addHeorByPool, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建[菜单]</span></span><br><span class="line">        <span class="keyword">var</span> menu = <span class="keyword">new</span> cc.Menu(itemCreate, itemReCreate);</span><br><span class="line">        menu.alignItemsHorizontallyWithPadding(<span class="number">150</span>);</span><br><span class="line">        <span class="keyword">this</span>.addChild(menu);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载[标签]_加载时间反馈</span></span><br><span class="line">    loadLabelInfo : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 创建[标签]</span></span><br><span class="line">        <span class="keyword">this</span>.labDirect = <span class="keyword">new</span> cc.LabelTTF(<span class="string">"直接创建耗费:"</span>, <span class="string">"Arial"</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="keyword">this</span>.labDirect.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(<span class="number">-230</span>, <span class="number">-65</span>)));</span><br><span class="line">        <span class="keyword">this</span>.labDirect.anchorY = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.addChild(<span class="keyword">this</span>.labDirect);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建[标签]</span></span><br><span class="line">        <span class="keyword">this</span>.poolLabel = <span class="keyword">new</span> cc.LabelTTF(<span class="string">"使用pool创建耗费:"</span>, <span class="string">"Arial"</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="keyword">this</span>.poolLabel.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(<span class="number">200</span>, <span class="number">-65</span>)));</span><br><span class="line">        <span class="keyword">this</span>.poolLabel.anchorY = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.addChild(<span class="keyword">this</span>.poolLabel);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 准备工作[创建好对象，并把他们放入对象缓冲池]</span></span><br><span class="line">    prepareHeroForPool : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.createCount; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> node = SupportPoolHero.create(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">this</span>.addChild(node);</span><br><span class="line">            cc.pool.putInPool(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加[精灵]_直接生成</span></span><br><span class="line">    addSpriteByCreate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createHeroList = [];</span><br><span class="line">        <span class="keyword">this</span>.timeStart(<span class="string">"directly"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.createCount; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> node = SupportPoolHero.create(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">this</span>.createHeroList.push(node);</span><br><span class="line">            <span class="keyword">this</span>.addChild(node);</span><br><span class="line">            node.setPosition(<span class="number">10</span> * i, cc.visibleRect.height * <span class="number">0.8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.setDirectLabel(<span class="keyword">this</span>.timeEnd(<span class="string">"directly"</span>));</span><br><span class="line">        <span class="keyword">this</span>.scheduleOnce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.createHeroList.length; i++) &#123;</span><br><span class="line">                <span class="keyword">this</span>.createHeroList[i].removeFromParent(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.createHeroList = [];</span><br><span class="line">        &#125;, <span class="number">0.5</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 从pool中获取英雄</span></span><br><span class="line">    addHeorByPool: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reCreateHeroList = [];</span><br><span class="line">        <span class="keyword">this</span>.timeStart(<span class="string">"use Pool"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.createCount; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> node = SupportPoolHero.reCreate(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">            <span class="keyword">this</span>.reCreateHeroList.push(node);</span><br><span class="line">            <span class="keyword">this</span>.addChild(node);</span><br><span class="line">            node.setPosition(<span class="number">10</span> * i, cc.visibleRect.height * <span class="number">0.8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.setPoolLabel(<span class="keyword">this</span>.timeEnd(<span class="string">"use Pool"</span>));</span><br><span class="line">        <span class="keyword">this</span>.scheduleOnce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.reCreateHeroList.length; i++) &#123;</span><br><span class="line">                cc.pool.putInPool(<span class="keyword">this</span>.reCreateHeroList[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.reCreateHeroList = [];</span><br><span class="line">        &#125;, <span class="number">0.5</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    timeStart: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timeList[name] = &#123;<span class="attr">startTime</span>: <span class="built_in">Date</span>.now(), <span class="attr">EndTime</span>: <span class="number">0</span>, <span class="attr">DeltaTime</span>: <span class="number">0</span>&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    timeEnd: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> obj = <span class="keyword">this</span>.timeList[name];</span><br><span class="line">        obj.EndTime = <span class="built_in">Date</span>.now();</span><br><span class="line">        obj.DeltaTime = obj.EndTime - obj.startTime;</span><br><span class="line">        <span class="keyword">return</span> obj.DeltaTime;</span><br><span class="line">    &#125;,</span><br><span class="line">    setDirectLabel: <span class="function"><span class="keyword">function</span> (<span class="params">time</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (time == <span class="number">0</span>) &#123;</span><br><span class="line">            time = <span class="string">"&lt;1"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.labDirect.setString(<span class="string">"直接创建耗费:"</span> + time + <span class="string">"ms"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    setPoolLabel: <span class="function"><span class="keyword">function</span> (<span class="params">time</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (time == <span class="number">0</span>) &#123;</span><br><span class="line">            time = <span class="string">"&lt;1"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.poolLabel.setString(<span class="string">"使用pool创建耗费::"</span> + time + <span class="string">"ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="批量渲染"><a href="#批量渲染" class="headerlink" title="批量渲染"></a>批量渲染</h2><p>一般情况下，将图片按照模块分类，用TexturePacker合成大图，这样合理的管理了图片资源，也更贴近引擎的渲染优化。</p>
<h2 id="cocos2d-x的自动批渲染"><a href="#cocos2d-x的自动批渲染" class="headerlink" title="cocos2d-x的自动批渲染"></a>cocos2d-x的自动批渲染</h2><p>见cocos2d-x绘制系统的博文，自动批绘制需要相关的绘制命令在执行顺序上相邻</p>
<p>##SpriteBatchNode技术</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>批处理绘制精灵，创建一张纹理，然后将多个精灵添加到此纹理中，绘制时直接绘制该纹理，无需单独绘制子节点。因为在Web上，优先采用WebGL渲染，若不支持WebGL，则采用Canvas绘制。只在WebGL情况下有效</p>
<p>渲染每个精灵的过程都会经历“打开-绘制-关闭”的流程，使用SpriteBatchNode的时候只用打开关闭一次。</p>
<p>###源码</p>
<p>需要再看</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>将纹理加载到内存。</p>
<p>创建SpriteBatchNode。</p>
<p>创建精灵并将其添加到SpriteBatchNode。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> BatchNodeLayer = cc.Layer.extend(&#123;</span><br><span class="line">    batchNode : <span class="literal">null</span>,</span><br><span class="line">    ctor : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._super();</span><br><span class="line">        <span class="comment">// 第一步：加载[资源]</span></span><br><span class="line">        <span class="keyword">this</span>.loadResource();</span><br><span class="line">        <span class="comment">// 第二步：加载[BatchNode]</span></span><br><span class="line">        <span class="keyword">this</span>.loadBatchNode();</span><br><span class="line">        <span class="comment">// 第三步：加载[8000个精灵]</span></span><br><span class="line">        <span class="keyword">this</span>.loadSomePrince();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载[资源]</span></span><br><span class="line">    loadResource : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        cc.textureCache.addImage(res.u13_prince_png);</span><br><span class="line">        cc.spriteFrameCache.addSpriteFrames(res.u13_prince_plist);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载[SpriteBatchNode]</span></span><br><span class="line">    loadBatchNode : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.batchNode = <span class="keyword">new</span> cc.SpriteBatchNode(res.u13_prince_png);</span><br><span class="line">        <span class="keyword">this</span>.addChild(<span class="keyword">this</span>.batchNode);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载[8000个精灵]_并将其添加到this.batchNode中</span></span><br><span class="line">    loadSomePrince : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> node = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> pos = cc.p(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8000</span>; i++) &#123;    <span class="comment">// 创建8000个精灵</span></span><br><span class="line">            node = <span class="keyword">new</span> cc.Sprite(<span class="string">"#prince_stand_1.png"</span>);</span><br><span class="line">            <span class="comment">//this.batchNode.addChild(node);  // 添加到batchNode对象中</span></span><br><span class="line">            <span class="keyword">this</span>.addChild(node);</span><br><span class="line"></span><br><span class="line">            pos.x = <span class="built_in">Math</span>.random() * cc.visibleRect.width;</span><br><span class="line">            pos.y = <span class="built_in">Math</span>.random() * cc.visibleRect.height;</span><br><span class="line">            node.setPosition(pos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="烘焙层"><a href="#烘焙层" class="headerlink" title="烘焙层"></a>烘焙层</h2><p>对于一些很少发生例如添加删除运行动作的变动的层，我们可以使用图层预烘焙技术。</p>
<p>cc.Layer的bake函数，一个调用了bake函数的层会将其自身以及所有子节点烘焙到一张画布（canvas）上，只要自身以及所有子节点不发生例如添加或者删除子节点以及运行动作等变动行为，那么在下一帧绘制时，引擎会将预烘焙到画布上的内容直接绘制出来。使得原本需要调用多次绘制的层，现在只需要绘制一次。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> BakeLayer = cc.Layer.extend(&#123;</span><br><span class="line">    lastPrince : <span class="literal">null</span>,</span><br><span class="line">    ctor : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._super();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.loadMenu();</span><br><span class="line">        <span class="keyword">this</span>.loadSomePrince();</span><br><span class="line">    &#125;,</span><br><span class="line">    loadMenu : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> itemBake = <span class="keyword">new</span> cc.MenuItemFont(<span class="string">"bake"</span>, <span class="keyword">this</span>.onBake, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">var</span> itemUnbake = <span class="keyword">new</span> cc.MenuItemFont(<span class="string">"unbake"</span>, <span class="keyword">this</span>.onUnbake, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">var</span> itemRunAction = <span class="keyword">new</span> cc.MenuItemFont(<span class="string">"run action"</span>, <span class="keyword">this</span>.onRunAction, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> menu = <span class="keyword">new</span> cc.Menu(itemBake, itemUnbake, itemRunAction);</span><br><span class="line">        <span class="keyword">this</span>.addChild(menu, <span class="number">1</span>);</span><br><span class="line">        menu.alignItemsVertically();</span><br><span class="line">        menu.x = cc.winSize.width - <span class="number">100</span>;</span><br><span class="line">        menu.y = cc.winSize.height - <span class="number">80</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    loadSomePrince : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> node = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> pos = cc.p(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8000</span>; i++) &#123;    <span class="comment">// 创建8000个精灵</span></span><br><span class="line">            node = <span class="keyword">new</span> cc.Sprite(<span class="string">"#prince_stand_1.png"</span>);</span><br><span class="line">            <span class="keyword">this</span>.addChild(node);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 属性配置</span></span><br><span class="line">            pos.x = <span class="built_in">Math</span>.random() * cc.winSize.width + <span class="number">150</span>;</span><br><span class="line">            pos.y = <span class="built_in">Math</span>.random() * cc.winSize.height * <span class="number">0.65</span>;</span><br><span class="line">            node.setPosition(pos);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.lastPrince = node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    onBake : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bake();</span><br><span class="line">    &#125;,</span><br><span class="line">    onUnbake : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.unbake();</span><br><span class="line">    &#125;,</span><br><span class="line">    onRunAction : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> move = cc.moveBy(<span class="number">2</span>, cc.p(<span class="number">0</span>, <span class="number">-200</span>));</span><br><span class="line">        <span class="comment">//this.runAction(move);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.lastPrince.runAction(move);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>仅在Canvas渲染模式下有效</p>
<h2 id="图片资源优化"><a href="#图片资源优化" class="headerlink" title="图片资源优化"></a>图片资源优化</h2><p>在OpenGL/WebGL中，纹理的宽度和高度都必须是2的n次幂，超出则向上取最接近的</p>
<p>使用TP打包</p>
<p>生成.plist配置文件和一个.png。使用代码</p>
<p><code>cc.textureCache.addImage(res.xx_png);</code></p>
<p><code>cc.spriteFrameCache.addSpriteFrames(res.xx_plist);</code></p>
<p>使用TinyPNG压缩</p>
<h2 id="精灵的创建方式"><a href="#精灵的创建方式" class="headerlink" title="精灵的创建方式"></a>精灵的创建方式</h2><p>每个精灵一般都关联着一张纹理贴图，Texture2D对象</p>
<p>1.通过图片资源创建，直接传入图片的路径（不推荐）</p>
<p>2.通过纹理创建</p>
<p><code>var textrue = cc.textureCache.addImage(res.xx_png);</code></p>
<p><code>var node = new Sprite(textrue);</code></p>
<p>3.精灵表单，先将plist文件和图片加载到内存中，然后再创建</p>
<p><code>cc.spriteFrameCache.addSpriteFrames(res.xx_plist，res.xx_png);</code></p>
<p><code>var node = new Sprite(”#prince。png“);</code></p>
<p>4.创建带颜色的精灵</p>
<p>如果要纯色块的，setColor和setTextureRect，而不是setContentSize</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/28/Cocos2d-x的优化/" data-id="cjkjffpvs001ahov0ogk49frh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocos2d-x-优化/">Cocos2d-x 优化</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-网络-TCP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/27/网络-TCP/" class="article-date">
  <time datetime="2018-07-27T03:20:11.000Z" itemprop="datePublished">2018-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/27/网络-TCP/">网络-TCP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="TCP的包头"><a href="#TCP的包头" class="headerlink" title="TCP的包头"></a>TCP的包头</h2><p>包的序号：解决乱序问题</p>
<p>确认序号：</p>
<p>状态位：</p>
<p>窗口大小：通信双方各声明一个窗口，标识当前自己能够处理的能力</p>
<h1 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h1><p>三次握手除了双方建立连接外，主要还是为了沟通TCP包的序号问题</p>
<h1 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h1><h1 id="为何靠谱"><a href="#为何靠谱" class="headerlink" title="为何靠谱"></a>为何靠谱</h1><p>客户端没发送一个包，服务器端都有个回复，如果服务端超过一定时间没有回复，客户端就会重新发送这个包，，知道有回复</p>
<p>累计确认，累计应答</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/27/网络-TCP/" data-id="cjkjffpva0014hov00lg20z3m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-网络-UDP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/27/网络-UDP/" class="article-date">
  <time datetime="2018-07-27T02:55:41.000Z" itemprop="datePublished">2018-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/27/网络-UDP/">网络-UDP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="TCP和UDP的区别"><a href="#TCP和UDP的区别" class="headerlink" title="TCP和UDP的区别"></a>TCP和UDP的区别</h1><p>TCP是面向连接的，UDP是面向无连接的</p>
<p>所谓的建立连接，是为了在客户端和服务端维护连接，而建立一定的数据结构来维护双方交互的状态。用这样的数据结构来保证所谓的面向连接的特性。</p>
<p>eg:TCP提供可靠交付，通过TCP传输的数据，无差错，不丢失，不重复，按顺序到达。而UDP不保证不丢失，不保证按顺序到达。</p>
<p>TCP是面向字节流的，而UDP继承了IP的特性，基于数据报的，一个一个的发，一个一个的收。</p>
<p>TCP可以有拥塞控制<a href="https://mp.weixin.qq.com/s/j0WeTRgJMohIYr-SraMyBw，UDP没有，应用让发就发。" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/j0WeTRgJMohIYr-SraMyBw，UDP没有，应用让发就发。</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>TCP是一个有状态服务（有脑子的服务），它记着发送了没有，接收到没有，发送到哪个了，应该接收哪个了</p>
<h1 id="UDP的包头"><a href="#UDP的包头" class="headerlink" title="UDP的包头"></a>UDP的包头</h1><p>很简单，只有端口号</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/27/网络-UDP/" data-id="cjkjffpv80012hov0xijfc9a8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Matter-js学习-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/24/Matter-js学习-1/" class="article-date">
  <time datetime="2018-07-24T05:52:23.000Z" itemprop="datePublished">2018-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/24/Matter-js学习-1/">Matter.js学习-1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p><a href="http://brm.io/matter-js/docs/" target="_blank" rel="noopener">http://brm.io/matter-js/docs/</a></p>
<h1 id="英文"><a href="#英文" class="headerlink" title="英文"></a>英文</h1><p>terrific：极好的</p>
<p>cube：立方体</p>
<h1 id="Cautions"><a href="#Cautions" class="headerlink" title="Cautions"></a>Cautions</h1><p>忘记<code>float</code>类型和<code>int</code>类型不会自动转换的，因此，当你想表达浮点数零的时候，一定要写成<code>0.0</code>而非<code>0</code>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/24/Matter-js学习-1/" data-id="cjkjffpux000mhov09oe0roea" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="introduction-Matter-js" class="article article-type-introduction" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/24/Matter-js/" class="article-date">
  <time datetime="2018-07-24T05:51:36.000Z" itemprop="datePublished">2018-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/24/Matter-js/">Matter.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/24/Matter-js/" data-id="cjkjffpur000ghov0ywt4bx2n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos-JavaScript/">Cocos JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2d-x/">Cocos2d-x</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2d-x-OpenGL/">Cocos2d-x OpenGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2d-x-优化/">Cocos2d-x 优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2dx-JS/">Cocos2dx-JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript-JavaScript忍者秘籍/">JavaScript JavaScript忍者秘籍</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript-萧井陌/">Javascript 萧井陌</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/codefights/">codefights</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/程序员面试金典/">程序员面试金典</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cocos-JavaScript/" style="font-size: 10px;">Cocos JavaScript</a> <a href="/tags/Cocos2d-x/" style="font-size: 10px;">Cocos2d-x</a> <a href="/tags/Cocos2d-x-OpenGL/" style="font-size: 15px;">Cocos2d-x OpenGL</a> <a href="/tags/Cocos2d-x-优化/" style="font-size: 10px;">Cocos2d-x 优化</a> <a href="/tags/Cocos2dx-JS/" style="font-size: 10px;">Cocos2dx-JS</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/JavaScript-JavaScript忍者秘籍/" style="font-size: 10px;">JavaScript JavaScript忍者秘籍</a> <a href="/tags/Javascript-萧井陌/" style="font-size: 15px;">Javascript 萧井陌</a> <a href="/tags/codefights/" style="font-size: 10px;">codefights</a> <a href="/tags/程序员面试金典/" style="font-size: 10px;">程序员面试金典</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/网络/" style="font-size: 20px;">网络</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/07/动画/">动画</a>
          </li>
        
          <li>
            <a href="/2018/08/07/马里奥01/">马里奥01</a>
          </li>
        
          <li>
            <a href="/2018/08/06/ES-1/">ES-1</a>
          </li>
        
          <li>
            <a href="/2018/07/31/Cocos2d-x精灵/">Cocos2d-x精灵</a>
          </li>
        
          <li>
            <a href="/2018/07/30/Cocos2d-x纹理/">Cocos2d-x纹理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 kjlist<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>